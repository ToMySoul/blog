---
title: 隔离级别
categories: 工作
tags: 数据库
---

#### 隔离级别

1. 读取未提交内容

在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为脏读（Dirty Read）

2. 读取提交内容

这是大多数数据库系统的默认隔离级别（但不是MySQL默认的）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别 也支持所谓的不可重复读（Nonrepeatable Read），因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果

3. 可重读

这是MySQL的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：幻读 （Phantom Read）。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行。**InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题**。

4. 可串行化

这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。





#### 不同隔离级别带来的数据问题

- 脏读

事务读到另一个事务未提交的数据

- 不可重复读

事务读到另一个事务已提交修改的数据 

- 幻读

事务读到另一个事务已提交的新增或修改的数据

#### 隔离级别

| 隔离级别 | 脏读   | 不可重复读 | 幻读   |
| ---- | ---- | ----- | ---- |
| 未提交读 | √    | √     | √    |
| 已提交读 | ×    | √     | √    |
| 可重复读 | ×    | ×     | √    |
| 串行化  | ×    | ×     | ×    |

大多事数据库的隔离级别默认为已提交读；mysql 的默认隔离级别为不可重复读。

#### Mysql-幻读处理

MySQL默认采用的隔离级别是可重复读，在这种隔离级别下不同的读模式，针对幻读问题采用了不同解决方案：

针对快照读（普通 select 语句），是通过 MVCC 方式解决了幻读。
针对当前读（select ... for update 等语句），是通过 next-key lock（记录锁+间隙锁）方式解决了幻读。

