---
title: 树
tags: 数据结构
---

### 二叉查找树
{% asset_img 二叉查找树.jpg 二叉查找树 %}


上图就是根据User表创建的二叉查找树的索引。通过图片可知二叉查找树中的每个节点都存储了键(key)和值(data)。key对应的就是表中的id，data对应就是表中的一行数据。
二叉查找树的特点就是任意节点的左子节点的key都小于当前节点的key，右节点的key都大于当前节点key。

如果数据比较极端，二叉查找树会退化成单向链表，效率就会很低，为了解决这个问题引出平很二叉树。

### 平衡二叉树

{% asset_img 平衡二叉树.jpg 平衡二叉树 %}

平衡二叉树的特点就是满足二叉查找树的基础上，添加一个新的要求。每个节点的左右子树的高度差距不能超过1；左右子树也是一颗平衡二叉树。

如果数据量比较的情况平衡二叉树也存在很大的性能问题。造成这样问题的就是单个节点存在单个key和data。

### B树

{% asset_img B树.jpg B树 %}

创建一种单节点可以存储多个key和data的平衡树。就是B树

存储单元称之为页（页其实就是磁盘的每个磁盘块）

B树相对于平衡二叉树最大的改变就是每个节点可以储存更多的key和data。并且每个节点可以拥有更多的子节点，这样设计造成了树的高度降低了。由于树的高度降低了那么在查找数据的时候读取磁盘的次数就减少了（降低io操作）。

### B+Tree

{% asset_img B+树.jpg B+树 %}

B+树就是B树的一个升级。

1. B+树上除叶子节点其他节点是不存储数据的。B树上每个节点都存储了key和 ata。而B+树只在叶子节点上存储数据，其他节点只存储key。
   为什么要进行这样的改变呢？
   以innoDB存储引擎来说，数据库中页的大小是固定的，每页的默认大小为16K。如果页不存储数据(data)就可以存储更多的key,那么就可以尽可能的减少树的高度。总结来说B+树相对于B树来说又矮又胖。这时候如果查询那么就会降低很多IO操作。
   假定一个页16K可以存储1000个key。那么3层的B+树就可以存储100010001000=10亿条数据。而且根节点是常驻内存的，也就是说查询10亿条数据只需要进行2次IO操作。

2. B+树所有的数据都存储在叶子节点上并且是按照顺序排列的。那么使用B+树完成范围查找，排序查找，分组查找，去重查找就会很简单，效率也比较高。而B树就不可以。因为B树的数据是分散个各个节点上的。
3. B+树上每页之间是一个双向链表进行链接，叶子节点中的数据都是使用单向链表链接的。但是需要记得一点的是B树也可以加链表。
   PS：InnoDB存储引擎中索引就是这样存储的。InnoDB中的聚集索引就是上面的结构。需要记住一点是MyISAM中依然使用的是B+树，结构是一样的，原理也是一样的，区别在于存储不是数据而是数据的文件地址。

聚集索引和非聚集索引
聚集索引(聚簇索引):如果数据库使用InnoDB存储引擎，那么表中的数据一定会有一个主键，如果用户不创建主键系统也会帮你创建一个隐式的主键。
之所以一定要有主键因为InnoDB把数据放在B+树上，而B+树上的key就是主键。如果以主键构建的B+树索引那么就称之为聚集索引。
非聚集索引：以主键以外的列作为key构建B+树索引就称之为非聚集索引

使用聚集索引查找

{% asset_img 聚集索引查找流程.jpg 聚集索引查找流程 %}

核心思想：
根节点是常驻内存的，所有不需要进行IO操作
根据各节点找到对应的p，根据p的指针找到对应的下一级页。最终达到叶子节点。通过二分查找法定位到数据位置，通过单向链表或者当前页的数据，再通过双向链表获取下一页的数据，最终获取所有需要查询的数据。

使用非聚集索引查找

{% asset_img 非聚集索引查找流程.jpg 非聚集索引查找流程 %}

如果使用的是非聚集索引那么叶子节点存储的内容发生了改变。聚集索引存储的是数据，非聚集索引存储的是当前数据对应的主键。
{% asset_img 非聚集索引查找02.jpg 非聚集索引查找02 %}

核心思想：
定位为查询的数据以后只能得到索引对应的主键，那么需要根据主键进行回表查询(拿着主键去聚集索引中获取数据)。

### 红黑树

红黑树，是一种二叉搜索树，但在每个节点上增加一个存储位表示结点的颜色们可以是Red或是Black。通过任何一条从根到叶子的路径上各个节点着色方式的限制，红黑树确保没有一条路径会比其它路径长处两倍，因而是接近平衡的。

{% asset_img 红黑树.png 红黑树 %}


1. 每个节点不是红色就是黑色
2. 根节点是黑色的
3. 如果一个节点是红色的，则它的两个子节点是黑色的
4. 对于每个节点，从该节点到所有后代叶节点的简单路径上，均包含相同数目的黑色节点。
5. 每个叶子节点都是黑色的（此处的叶子节点指的都是空节点）